<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SoleStyle â€“ Backend Connected</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f5f5f5;margin:0}
header{background:#111;color:#fff;padding:15px}
.container{max-width:1100px;margin:auto;padding:20px}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}
.card{background:#fff;border-radius:8px;padding:15px}
.card img{width:100%;height:200px;object-fit:cover}
button{padding:8px 12px;border:none;background:#2563eb;color:#fff;border-radius:4px;cursor:pointer}
button:hover{opacity:.9}
.cart{margin-top:30px;background:#fff;padding:15px;border-radius:8px}
input{padding:8px;width:100%;margin-bottom:10px}
</style>
</head>

<body>

<header>
  <h2>SoleStyle Store</h2>
</header>

<div class="container">

<!-- LOGIN -->
<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<hr>

<!-- PRODUCTS -->
<h3>Products</h3>
<div class="products" id="products"></div>

<!-- CART -->
<div class="cart">
<h3>Your Cart</h3>
<div id="cart">Login to see cart</div>
</div>

</div>

<script>
/* ================= BASIC SETUP ================= */
const API = "http://localhost:5000/api";
let token = localStorage.getItem("token");

const productsDiv = document.getElementById("products");
const cartDiv = document.getElementById("cart");

/* ================= LOGIN ================= */
async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch(API + "/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email, password })
  });

  const data = await res.json();

  if(data.token){
    token = data.token;
    localStorage.setItem("token", token);
    alert("Login successful");
    loadCart();
  }else{
    alert(data.message || "Login failed");
  }
}

/* ================= PRODUCTS ================= */
async function loadProducts(){
  const res = await fetch(API + "/products");
  const products = await res.json();

  productsDiv.innerHTML = products.map(p=>`
    <div class="card">
      <img src="${p.image}">
      <h4>${p.name}</h4>
      <p>${p.brand}</p>
      <p>$${p.price}</p>
      <button onclick="addToCart('${p._id}')">Add to Cart</button>
    </div>
  `).join("");
}

/* ================= CART ================= */
async function loadCart(){
  if(!token){
    cartDiv.innerHTML = "Login to see cart";
    return;
  }

  const res = await fetch(API + "/cart",{
    headers:{ Authorization: token }
  });

  const cart = await res.json();

  if(!cart.items || cart.items.length === 0){
    cartDiv.innerHTML = "Cart is empty";
    return;
  }

  cartDiv.innerHTML = cart.items.map(i=>`
    <p>
      Product ID: ${i.productId} |
      Qty: ${i.quantity}
      <button onclick="removeFromCart('${i.productId}')">Remove</button>
    </p>
  `).join("");
}

async function addToCart(id){
  if(!token){
    alert("Please login first");
    return;
  }

  await fetch(API + "/cart",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization: token
    },
    body:JSON.stringify({ productId:id })
  });

  loadCart();
}

async function removeFromCart(id){
  await fetch(API + "/cart/" + id,{
    method:"DELETE",
    headers:{ Authorization: token }
  });

  loadCart();
}

/* ================= INIT ================= */
loadProducts();
if(token) loadCart();
</script>

</body>
</html>
